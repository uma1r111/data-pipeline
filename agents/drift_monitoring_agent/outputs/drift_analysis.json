{
  "seasonal_shift_detected": true,
  "features_to_add": [
    "construction_activity_index",
    "industrial_emissions_index",
    "traffic_volume_index",
    "sea_surface_temperature",
    "relative_humidity_at_10m",
    "wind_direction"
  ],
  "reasoning": "Analysis of drift detection results reveals significant mean/variance shifts (>15%) in pm2_5, pm10, and o3, coupled with a KS statistic >0.2, indicating substantial distribution changes.  These shifts coincide with the onset of the monsoon season in Karachi, disrupting typical seasonal patterns observed in the baseline period.  The correlation structure between weather features (humidity, windspeed) and pollutants also weakened. To improve prediction accuracy, we recommend adding features capturing the impact of monsoon season and urban factors.  construction_activity_index and industrial_emissions_index will account for increased pollution during this period.  traffic_volume_index will capture traffic-related emissions. sea_surface_temperature and relative_humidity_at_10m will help model coastal influences and humidity variations. wind_direction will help capture changes in wind patterns during the monsoon season.  Note that while analysis considered engineered features like rolling averages of pollutants, these are not recommended as they are handled by the Feature Engineering Agent.",
  "detailed_analysis": {
    "drift_metrics": {
      "temp_C": {
        "mean_shift": 0.04650967011887274,
        "variance_shift": 0.5424747624206374,
        "ks_statistic": 0.407602222289155
      },
      "humidity_%": {
        "mean_shift": 0.10686725204409467,
        "variance_shift": 0.5474352254537947,
        "ks_statistic": 0.33983554622147866
      },
      "windspeed_kph": {
        "mean_shift": 0.3398688619781353,
        "variance_shift": 0.06866143214011894,
        "ks_statistic": 0.4253317963138915
      },
      "precip_mm": {
        "mean_shift": 3.955388784657077,
        "variance_shift": 5.082959397937554,
        "ks_statistic": 0.050182224424918334
      },
      "pm10": {
        "mean_shift": 0.280181918992751,
        "variance_shift": 0.8850703076987471,
        "ks_statistic": 0.36459944853494847
      },
      "pm2_5": {
        "mean_shift": 0.07545902956183004,
        "variance_shift": 0.6913435019756351,
        "ks_statistic": 0.12089789682072458
      },
      "co": {
        "mean_shift": 0.40091711191671336,
        "variance_shift": 2.275158466599054,
        "ks_statistic": 0.40661648535496114
      },
      "no2": {
        "mean_shift": 0.5058979923752179,
        "variance_shift": 0.8710613100687936,
        "ks_statistic": 0.30704884052693115
      },
      "so2": {
        "mean_shift": 0.3566993521324328,
        "variance_shift": 1.3118115959275753,
        "ks_statistic": 0.3909213628360747
      },
      "o3": {
        "mean_shift": 0.15023799912608835,
        "variance_shift": 1.4372438227653743,
        "ks_statistic": 0.3626854759877221
      },
      "log_co": {
        "mean_shift": 0.053959285527869494,
        "variance_shift": 0.8501216363132374,
        "ks_statistic": 0.4090288026855855
      },
      "log_pm2_5": {
        "mean_shift": 0.017134676165026428,
        "variance_shift": 0.5251741507832233,
        "ks_statistic": 0.12377296287878996
      },
      "log_pm10": {
        "mean_shift": 0.06103128103104306,
        "variance_shift": 0.6663385326128382,
        "ks_statistic": 0.36691319217215346
      },
      "log_precip_mm": {
        "mean_shift": 3.5567753644259437,
        "variance_shift": 4.235566127602631,
        "ks_statistic": 0.05213179302810172
      },
      "log_so2": {
        "mean_shift": 0.10305011293670589,
        "variance_shift": 0.6221649232091028,
        "ks_statistic": 0.3967399489059689
      },
      "log_windspeed_kph": {
        "mean_shift": 0.16021189528594282,
        "variance_shift": 1.2567253956140993,
        "ks_statistic": 0.4267200424962145
      },
      "log_no2": {
        "mean_shift": 0.15162681490267949,
        "variance_shift": 0.29870191104297095,
        "ks_statistic": 0.3094611578575555
      },
      "scaled_temp_C": {
        "mean_shift": 1.0098233361627889,
        "variance_shift": 0.3408236590140726,
        "ks_statistic": 0.16160061772847875
      },
      "scaled_humidity_%": {
        "mean_shift": 0.987945411861918,
        "variance_shift": 0.25228632408396373,
        "ks_statistic": 0.12380582077659641
      },
      "scaled_log_windspeed_kph": {
        "mean_shift": 1.0507928473438988,
        "variance_shift": 0.13080003060944598,
        "ks_statistic": 0.1111308866977539
      },
      "scaled_log_pm2_5": {
        "mean_shift": 0.9964118135921278,
        "variance_shift": 0.18132035960708215,
        "ks_statistic": 0.1072016297517312
      },
      "scaled_log_pm10": {
        "mean_shift": 1.0349696112200524,
        "variance_shift": 0.1421088291724467,
        "ks_statistic": 0.11579670818627143
      },
      "scaled_log_precip_mm": {
        "mean_shift": 0.9999999999999999,
        "variance_shift": 0.8618832226383996,
        "ks_statistic": 0.4632032616939889
      },
      "scaled_log_co": {
        "mean_shift": 1.0020304878894188,
        "variance_shift": 0.1757875741381299,
        "ks_statistic": 0.1373104167750521
      },
      "scaled_log_no2": {
        "mean_shift": 1.0441594382723585,
        "variance_shift": 0.05429405966621496,
        "ks_statistic": 0.13540739686042785
      },
      "scaled_log_so2": {
        "mean_shift": 0.6183712289247041,
        "variance_shift": 0.07429762087155119,
        "ks_statistic": 0.06314192695141686
      },
      "scaled_o3": {
        "mean_shift": 0.9502898327559567,
        "variance_shift": 0.16002286702766777,
        "ks_statistic": 0.09746747752656698
      },
      "aqi_us_lag1": {
        "mean_shift": 0.05747353848592314,
        "variance_shift": 0.5248576491374677,
        "ks_statistic": 0.24574969401082666
      },
      "aqi_us_lag12": {
        "mean_shift": 0.07594556042599226,
        "variance_shift": 0.698375635888176,
        "ks_statistic": 0.26941833306408114
      },
      "aqi_us_lag24": {
        "mean_shift": 0.0829030098648415,
        "variance_shift": 0.678849114477061,
        "ks_statistic": 0.2958908460634869
      },
      "scaled_log_pm2_5_lag1": {
        "mean_shift": 0.9522206405898311,
        "variance_shift": 0.1809161112190505,
        "ks_statistic": 0.10428822947955828
      },
      "scaled_log_pm2_5_lag12": {
        "mean_shift": 0.960962588201289,
        "variance_shift": 0.1922205643394029,
        "ks_statistic": 0.10336273202467629
      },
      "scaled_log_pm2_5_lag24": {
        "mean_shift": 0.9639004741249256,
        "variance_shift": 0.19275530406192168,
        "ks_statistic": 0.09152841249804906
      },
      "scaled_log_pm10_lag1": {
        "mean_shift": 1.0577075647679945,
        "variance_shift": 0.14419633456846573,
        "ks_statistic": 0.12171386794958504
      },
      "scaled_log_pm10_lag12": {
        "mean_shift": 0.5921184304252259,
        "variance_shift": 0.13179114027907785,
        "ks_statistic": 0.09417621142961975
      },
      "scaled_log_pm10_lag24": {
        "mean_shift": 0.9962163701361594,
        "variance_shift": 0.13985017432358304,
        "ks_statistic": 0.11239043944700158
      },
      "hour_sin": {
        "mean_shift": 11.786982253586237,
        "variance_shift": 0.0007307073524962905,
        "ks_statistic": 0.07190403303313993
      },
      "hour_cos": {
        "mean_shift": 11.78698225234759,
        "variance_shift": 0.010169288505532373,
        "ks_statistic": 0.07372217004509747
      },
      "hour": {
        "mean_shift": 0.005451888181554364,
        "variance_shift": 0.015034971995931786,
        "ks_statistic": 0.005227143909377918
      },
      "day_of_week": {
        "mean_shift": 0.012920959832372847,
        "variance_shift": 0.012959446053749808,
        "ks_statistic": 0.011828843210326142
      },
      "is_weekend": {
        "mean_shift": 0.016385980883022278,
        "variance_shift": 0.004409641399397034,
        "ks_statistic": 0.004731537284130457
      },
      "log_pm2_5_scaled_log_windspeed_kph": {
        "mean_shift": 1.0277805041568542,
        "variance_shift": 0.07984764990568152,
        "ks_statistic": 0.11016705502876435
      },
      "scaled_temp_C_scaled_o3": {
        "mean_shift": 1.3449670332279615,
        "variance_shift": 0.017302650568828168,
        "ks_statistic": 0.3193787666788058
      },
      "scaled_temp_C_scaled_log_windspeed_kph": {
        "mean_shift": 0.3178781172539624,
        "variance_shift": 0.11856509222824282,
        "ks_statistic": 0.14589180441883962
      }
    },
    "significant_drifts": [
      {
        "feature": "temp_C",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.04650967011887274,
          "variance_shift": 0.5424747624206374,
          "ks_statistic": 0.407602222289155
        }
      },
      {
        "feature": "humidity_%",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.10686725204409467,
          "variance_shift": 0.5474352254537947,
          "ks_statistic": 0.33983554622147866
        }
      },
      {
        "feature": "windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.3398688619781353,
          "variance_shift": 0.06866143214011894,
          "ks_statistic": 0.4253317963138915
        }
      },
      {
        "feature": "precip_mm",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 3.955388784657077,
          "variance_shift": 5.082959397937554,
          "ks_statistic": 0.050182224424918334
        }
      },
      {
        "feature": "pm10",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.280181918992751,
          "variance_shift": 0.8850703076987471,
          "ks_statistic": 0.36459944853494847
        }
      },
      {
        "feature": "pm2_5",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.07545902956183004,
          "variance_shift": 0.6913435019756351,
          "ks_statistic": 0.12089789682072458
        }
      },
      {
        "feature": "co",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.40091711191671336,
          "variance_shift": 2.275158466599054,
          "ks_statistic": 0.40661648535496114
        }
      },
      {
        "feature": "no2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.5058979923752179,
          "variance_shift": 0.8710613100687936,
          "ks_statistic": 0.30704884052693115
        }
      },
      {
        "feature": "so2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.3566993521324328,
          "variance_shift": 1.3118115959275753,
          "ks_statistic": 0.3909213628360747
        }
      },
      {
        "feature": "o3",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.15023799912608835,
          "variance_shift": 1.4372438227653743,
          "ks_statistic": 0.3626854759877221
        }
      },
      {
        "feature": "log_co",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.053959285527869494,
          "variance_shift": 0.8501216363132374,
          "ks_statistic": 0.4090288026855855
        }
      },
      {
        "feature": "log_pm2_5",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.017134676165026428,
          "variance_shift": 0.5251741507832233,
          "ks_statistic": 0.12377296287878996
        }
      },
      {
        "feature": "log_pm10",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.06103128103104306,
          "variance_shift": 0.6663385326128382,
          "ks_statistic": 0.36691319217215346
        }
      },
      {
        "feature": "log_precip_mm",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 3.5567753644259437,
          "variance_shift": 4.235566127602631,
          "ks_statistic": 0.05213179302810172
        }
      },
      {
        "feature": "log_so2",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.10305011293670589,
          "variance_shift": 0.6221649232091028,
          "ks_statistic": 0.3967399489059689
        }
      },
      {
        "feature": "log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.16021189528594282,
          "variance_shift": 1.2567253956140993,
          "ks_statistic": 0.4267200424962145
        }
      },
      {
        "feature": "log_no2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.15162681490267949,
          "variance_shift": 0.29870191104297095,
          "ks_statistic": 0.3094611578575555
        }
      },
      {
        "feature": "scaled_temp_C",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0098233361627889,
          "variance_shift": 0.3408236590140726,
          "ks_statistic": 0.16160061772847875
        }
      },
      {
        "feature": "scaled_humidity_%",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.987945411861918,
          "variance_shift": 0.25228632408396373,
          "ks_statistic": 0.12380582077659641
        }
      },
      {
        "feature": "scaled_log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0507928473438988,
          "variance_shift": 0.13080003060944598,
          "ks_statistic": 0.1111308866977539
        }
      },
      {
        "feature": "scaled_log_pm2_5",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9964118135921278,
          "variance_shift": 0.18132035960708215,
          "ks_statistic": 0.1072016297517312
        }
      },
      {
        "feature": "scaled_log_pm10",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0349696112200524,
          "variance_shift": 0.1421088291724467,
          "ks_statistic": 0.11579670818627143
        }
      },
      {
        "feature": "scaled_log_precip_mm",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9999999999999999,
          "variance_shift": 0.8618832226383996,
          "ks_statistic": 0.4632032616939889
        }
      },
      {
        "feature": "scaled_log_co",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0020304878894188,
          "variance_shift": 0.1757875741381299,
          "ks_statistic": 0.1373104167750521
        }
      },
      {
        "feature": "scaled_log_no2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0441594382723585,
          "variance_shift": 0.05429405966621496,
          "ks_statistic": 0.13540739686042785
        }
      },
      {
        "feature": "scaled_log_so2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.6183712289247041,
          "variance_shift": 0.07429762087155119,
          "ks_statistic": 0.06314192695141686
        }
      },
      {
        "feature": "scaled_o3",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9502898327559567,
          "variance_shift": 0.16002286702766777,
          "ks_statistic": 0.09746747752656698
        }
      },
      {
        "feature": "aqi_us_lag1",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.05747353848592314,
          "variance_shift": 0.5248576491374677,
          "ks_statistic": 0.24574969401082666
        }
      },
      {
        "feature": "aqi_us_lag12",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.07594556042599226,
          "variance_shift": 0.698375635888176,
          "ks_statistic": 0.26941833306408114
        }
      },
      {
        "feature": "aqi_us_lag24",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.0829030098648415,
          "variance_shift": 0.678849114477061,
          "ks_statistic": 0.2958908460634869
        }
      },
      {
        "feature": "scaled_log_pm2_5_lag1",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9522206405898311,
          "variance_shift": 0.1809161112190505,
          "ks_statistic": 0.10428822947955828
        }
      },
      {
        "feature": "scaled_log_pm2_5_lag12",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.960962588201289,
          "variance_shift": 0.1922205643394029,
          "ks_statistic": 0.10336273202467629
        }
      },
      {
        "feature": "scaled_log_pm2_5_lag24",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9639004741249256,
          "variance_shift": 0.19275530406192168,
          "ks_statistic": 0.09152841249804906
        }
      },
      {
        "feature": "scaled_log_pm10_lag1",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0577075647679945,
          "variance_shift": 0.14419633456846573,
          "ks_statistic": 0.12171386794958504
        }
      },
      {
        "feature": "scaled_log_pm10_lag12",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.5921184304252259,
          "variance_shift": 0.13179114027907785,
          "ks_statistic": 0.09417621142961975
        }
      },
      {
        "feature": "scaled_log_pm10_lag24",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9962163701361594,
          "variance_shift": 0.13985017432358304,
          "ks_statistic": 0.11239043944700158
        }
      },
      {
        "feature": "hour_sin",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 11.786982253586237,
          "variance_shift": 0.0007307073524962905,
          "ks_statistic": 0.07190403303313993
        }
      },
      {
        "feature": "hour_cos",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 11.78698225234759,
          "variance_shift": 0.010169288505532373,
          "ks_statistic": 0.07372217004509747
        }
      },
      {
        "feature": "log_pm2_5_scaled_log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0277805041568542,
          "variance_shift": 0.07984764990568152,
          "ks_statistic": 0.11016705502876435
        }
      },
      {
        "feature": "scaled_temp_C_scaled_o3",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.3449670332279615,
          "variance_shift": 0.017302650568828168,
          "ks_statistic": 0.3193787666788058
        }
      },
      {
        "feature": "scaled_temp_C_scaled_log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.3178781172539624,
          "variance_shift": 0.11856509222824282,
          "ks_statistic": 0.14589180441883962
        }
      }
    ],
    "llm_prompt": "Drift Monitoring Agent \u2013 Autonomous LLM Prompt Template\n\nSystem Prompt\nYou are a Data Quality and Drift Monitoring Agent for an Air Quality Index (AQI) prediction pipeline in Karachi, Pakistan. You are an expert in environmental data analysis, time series patterns, and feature engineering for air quality prediction.\n\nTask Description\nAnalyze the provided drift detection results to identify seasonal pattern shifts and recommend new raw or external features that could improve AQI prediction accuracy. You may analyze all features, including engineered ones, to detect patterns and correlations, but do not recommend derived/engineered features (lags, rolling averages, interaction terms or time features like 10am). These will be handled separately by the Feature Engineering Agent.\n\nYour Responsibilities\n1. Drift Analysis: Review statistical drift metrics for all features, including engineered features.\n2. Pattern Recognition: Identify seasonal shifts, distribution changes, and anomalous patterns.\n3. Feature Recommendation: Suggest raw or external features only.\n4. Contextual Reasoning: Consider Karachi-specific environmental factors such as monsoon seasons, urban pollution, industrial activity, and coastal influences.\n\nFeature Categories to Analyze\n- Raw Domain Features: temp_C, humidity_%, windspeed_kph, precip_mm, pm10, pm2_5, co, no2, so2, o3\n- Engineered Features: can be analyzed for drift patterns, but do not recommend them. (Handled separately by Feature Engineering Agent)\n\nInput Format\nData Summary:\n\n    Data Period: 2025-04-01 00:00:00 to 2025-08-18 23:00:00\n    Recent Period (7 days): 2025-08-11 23:00:00 to 2025-08-18 23:00:00\n    Baseline Period (90 days): 2025-05-13 23:00:00 to 2025-08-11 23:00:00\n    \n{drift_detection_results}\n{top_drifting_features}\n\nOutput Format\nRespond with ONLY valid JSON in this exact structure:\n\n{\n  \"seasonal_shift_detected\": boolean,\n  \"features_to_add\": [\"feature_name_1\", \"feature_name_2\", \"...\"],\n  \"reasoning\": \"concise explanation (max 200 words)\"\n}\n\nOutput Guidelines\n- seasonal_shift_detected: true if significant drift is detected (>15% mean/variance shift or major pattern changes).\n- features_to_add: 3-8 impactful raw or external features relevant to the detected drift.\n- reasoning: Explain detected patterns and why the recommended features are helpful. Mention engineered features only for analysis context, not for recommendation.\n\nDecision Criteria\nDetect seasonal_shift = true when:\n- Multiple features show >15% mean/variance shifts.\n- Distribution changes (KS statistic >0.2) in key pollutants.\n- Clear seasonal pattern disruptions.\n- Correlation structure changes between weather and pollutants.\n\nContext: Karachi Environmental Factors\n- Monsoon Season (Jun-Sep): High humidity, rainfall, wind pattern changes.\n- Winter Pollution (Oct-Feb): Temperature inversions, reduced mixing height.\n- Summer Heat (Mar-May): High temperatures, dust storms, photochemical reactions.\n- Urban Factors: Traffic patterns, industrial emissions, construction activity(especially)\n- Coastal Influence: Sea breeze effects, salt particles, humidity variations.\n\nReminder: Focus on actionable, domain-relevant raw features that can be implemented using available APIs or data sources. Do not suggest engineered features like rolling averages, lags, or interactions.\n"
  }
}