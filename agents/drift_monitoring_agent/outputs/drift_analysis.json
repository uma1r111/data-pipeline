{
  "seasonal_shift_detected": true,
  "features_to_add": [
    "uv_index",
    "air_pressure_hpa",
    "monsoon_season",
    "wind_direction",
    "pm2_5_rolling_7d",
    "temp_humidity_interaction"
  ],
  "reasoning": "Analysis of the provided drift detection results reveals a significant shift in the seasonal pattern, particularly impacting pollutant concentrations.  Multiple features show mean/variance shifts exceeding the 15% threshold, and the Kolmogorov-Smirnov statistic indicates substantial distribution changes in key pollutants like pm2.5 and pm10.  The onset of the monsoon season (June-September) in Karachi is likely a major contributor.  To improve prediction accuracy, we recommend adding 'uv_index' to account for photochemical smog, 'air_pressure_hpa' for pollutant dispersion, and 'wind_direction' for transport patterns.  'monsoon_season' as a boolean feature will directly capture the seasonal effect.  'pm2_5_rolling_7d' will smooth out high-variance periods, and 'temp_humidity_interaction' will capture the heat index, crucial during the summer months.",
  "detailed_analysis": {
    "drift_metrics": {
      "temp_C": {
        "mean_shift": 0.06883403976986302,
        "variance_shift": 0.7327581758085661,
        "ks_statistic": 0.5382726055491514
      },
      "humidity_%": {
        "mean_shift": 0.07174844652157054,
        "variance_shift": 0.7766680017576154,
        "ks_statistic": 0.2239019301276803
      },
      "windspeed_kph": {
        "mean_shift": 0.1665910904847827,
        "variance_shift": 0.7274696633101285,
        "ks_statistic": 0.33290526794246583
      },
      "precip_mm": {
        "mean_shift": 1.0,
        "variance_shift": 1.0,
        "ks_statistic": 0.020823692734844978
      },
      "pm10": {
        "mean_shift": 0.3805314470149524,
        "variance_shift": 0.9500216031878121,
        "ks_statistic": 0.5552218045009844
      },
      "pm2_5": {
        "mean_shift": 0.2552945409083053,
        "variance_shift": 0.8820162672855617,
        "ks_statistic": 0.5326456905497948
      },
      "co": {
        "mean_shift": 0.10874275094549765,
        "variance_shift": 0.5800285475607294,
        "ks_statistic": 0.12873450544756565
      },
      "no2": {
        "mean_shift": 0.2002050698466867,
        "variance_shift": 0.5888728073337085,
        "ks_statistic": 0.14279768570873116
      },
      "so2": {
        "mean_shift": 0.2188497044181949,
        "variance_shift": 0.8312553233991444,
        "ks_statistic": 0.4420537281392299
      },
      "o3": {
        "mean_shift": 0.23808694123028984,
        "variance_shift": 0.7821773185882144,
        "ks_statistic": 0.3232915946759253
      },
      "log_co": {
        "mean_shift": 0.01784905720412235,
        "variance_shift": 0.2548484310226049,
        "ks_statistic": 0.13177659915281387
      },
      "log_pm2_5": {
        "mean_shift": 0.07844930114862403,
        "variance_shift": 0.7306635824603591,
        "ks_statistic": 0.5326456905497948
      },
      "log_pm10": {
        "mean_shift": 0.09364732482410244,
        "variance_shift": 0.7826195892277341,
        "ks_statistic": 0.5574068547051141
      },
      "log_precip_mm": {
        "mean_shift": 1.0,
        "variance_shift": 1.0,
        "ks_statistic": 0.020823692734844978
      },
      "log_so2": {
        "mean_shift": 0.07627543797328018,
        "variance_shift": 0.6306186732531986,
        "ks_statistic": 0.45084595396060884
      },
      "log_windspeed_kph": {
        "mean_shift": 0.06973098454803969,
        "variance_shift": 0.8535360408195558,
        "ks_statistic": 0.3438661150190713
      },
      "log_no2": {
        "mean_shift": 0.06490027933381405,
        "variance_shift": 0.30590947875848135,
        "ks_statistic": 0.14696242425570016
      },
      "scaled_temp_C": {
        "mean_shift": 1.0284607769582648,
        "variance_shift": 0.3888884919171531,
        "ks_statistic": 0.21088746443817102
      },
      "scaled_humidity_%": {
        "mean_shift": 0.9701990535274616,
        "variance_shift": 0.28272085179331385,
        "ks_statistic": 0.13392605330098656
      },
      "scaled_log_windspeed_kph": {
        "mean_shift": 1.1216610240611602,
        "variance_shift": 0.1317957695554711,
        "ks_statistic": 0.1272367329392211
      },
      "scaled_log_pm2_5": {
        "mean_shift": 0.9656943879721341,
        "variance_shift": 0.22460998018028136,
        "ks_statistic": 0.12314592466231665
      },
      "scaled_log_pm10": {
        "mean_shift": 1.021019818526203,
        "variance_shift": 0.19655375122996788,
        "ks_statistic": 0.15139002598512086
      },
      "scaled_log_precip_mm": {
        "mean_shift": 1.0,
        "variance_shift": 1.0,
        "ks_statistic": 0.6126793151318833
      },
      "scaled_log_co": {
        "mean_shift": 1.0122731588917078,
        "variance_shift": 0.24670856597361407,
        "ks_statistic": 0.19367540230388627
      },
      "scaled_log_no2": {
        "mean_shift": 1.0526807212760034,
        "variance_shift": 0.06477315006887005,
        "ks_statistic": 0.08460087237718676
      },
      "scaled_log_so2": {
        "mean_shift": 0.9888571185872742,
        "variance_shift": 0.0720275825625236,
        "ks_statistic": 0.16621441421213606
      },
      "scaled_o3": {
        "mean_shift": 0.9451877401337971,
        "variance_shift": 0.17257773557861897,
        "ks_statistic": 0.10643768362773097
      },
      "aqi_us_lag1": {
        "mean_shift": 0.17736701933060017,
        "variance_shift": 0.9381984331206826,
        "ks_statistic": 0.7427117075428042
      },
      "aqi_us_lag12": {
        "mean_shift": 0.17791124908605244,
        "variance_shift": 0.9394023091746707,
        "ks_statistic": 0.7459509486348913
      },
      "aqi_us_lag24": {
        "mean_shift": 0.18148060689398063,
        "variance_shift": 0.935219036959174,
        "ks_statistic": 0.7515039333641832
      },
      "scaled_log_pm2_5_lag1": {
        "mean_shift": 1.040678337269566,
        "variance_shift": 0.19037606726378395,
        "ks_statistic": 0.12314592466231665
      },
      "scaled_log_pm2_5_lag12": {
        "mean_shift": 0.8402611274527164,
        "variance_shift": 0.15236630211905722,
        "ks_statistic": 0.12512013668885488
      },
      "scaled_log_pm2_5_lag24": {
        "mean_shift": 1.0051487711168328,
        "variance_shift": 0.2255497311046069,
        "ks_statistic": 0.15051655353509907
      },
      "scaled_log_pm10_lag1": {
        "mean_shift": 1.1259709016800263,
        "variance_shift": 0.15687187107781983,
        "ks_statistic": 0.15139002598512086
      },
      "scaled_log_pm10_lag12": {
        "mean_shift": 0.9688208421410373,
        "variance_shift": 0.14237637016859775,
        "ks_statistic": 0.1286468843867484
      },
      "scaled_log_pm10_lag24": {
        "mean_shift": 1.0331537737600545,
        "variance_shift": 0.20364335645641907,
        "ks_statistic": 0.15217040105802432
      },
      "hour_sin": {
        "mean_shift": 11.786982253586324,
        "variance_shift": 0.0007307073636583821,
        "ks_statistic": 0.07745701776243193
      },
      "hour_cos": {
        "mean_shift": 11.786982252347485,
        "variance_shift": 0.010169288516791167,
        "ks_statistic": 0.07927515477438946
      },
      "hour": {
        "mean_shift": 0.005451888181554364,
        "variance_shift": 0.015034971995931786,
        "ks_statistic": 0.005227143909377918
      },
      "day_of_week": {
        "mean_shift": 0.007466025898715307,
        "variance_shift": 0.002482675692925123,
        "ks_statistic": 0.009463074568260914
      },
      "is_weekend": {
        "mean_shift": 0.016385980883022278,
        "variance_shift": 0.004409641399397033,
        "ks_statistic": 0.004731537284130457
      },
      "log_pm2_5_scaled_log_windspeed_kph": {
        "mean_shift": 1.0395518481503758,
        "variance_shift": 0.060992733315560606,
        "ks_statistic": 0.12363331681311249
      },
      "scaled_temp_C_scaled_o3": {
        "mean_shift": 1.6017354349369166,
        "variance_shift": 0.06791272224373784,
        "ks_statistic": 0.3260543962498186
      },
      "scaled_temp_C_scaled_log_windspeed_kph": {
        "mean_shift": 0.7409162861737226,
        "variance_shift": 0.07222735717129397,
        "ks_statistic": 0.2340194244939199
      }
    },
    "significant_drifts": [
      {
        "feature": "temp_C",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.06883403976986302,
          "variance_shift": 0.7327581758085661,
          "ks_statistic": 0.5382726055491514
        }
      },
      {
        "feature": "humidity_%",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.07174844652157054,
          "variance_shift": 0.7766680017576154,
          "ks_statistic": 0.2239019301276803
        }
      },
      {
        "feature": "windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.1665910904847827,
          "variance_shift": 0.7274696633101285,
          "ks_statistic": 0.33290526794246583
        }
      },
      {
        "feature": "precip_mm",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0,
          "variance_shift": 1.0,
          "ks_statistic": 0.020823692734844978
        }
      },
      {
        "feature": "pm10",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.3805314470149524,
          "variance_shift": 0.9500216031878121,
          "ks_statistic": 0.5552218045009844
        }
      },
      {
        "feature": "pm2_5",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.2552945409083053,
          "variance_shift": 0.8820162672855617,
          "ks_statistic": 0.5326456905497948
        }
      },
      {
        "feature": "co",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.10874275094549765,
          "variance_shift": 0.5800285475607294,
          "ks_statistic": 0.12873450544756565
        }
      },
      {
        "feature": "no2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.2002050698466867,
          "variance_shift": 0.5888728073337085,
          "ks_statistic": 0.14279768570873116
        }
      },
      {
        "feature": "so2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.2188497044181949,
          "variance_shift": 0.8312553233991444,
          "ks_statistic": 0.4420537281392299
        }
      },
      {
        "feature": "o3",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.23808694123028984,
          "variance_shift": 0.7821773185882144,
          "ks_statistic": 0.3232915946759253
        }
      },
      {
        "feature": "log_co",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.01784905720412235,
          "variance_shift": 0.2548484310226049,
          "ks_statistic": 0.13177659915281387
        }
      },
      {
        "feature": "log_pm2_5",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.07844930114862403,
          "variance_shift": 0.7306635824603591,
          "ks_statistic": 0.5326456905497948
        }
      },
      {
        "feature": "log_pm10",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.09364732482410244,
          "variance_shift": 0.7826195892277341,
          "ks_statistic": 0.5574068547051141
        }
      },
      {
        "feature": "log_precip_mm",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0,
          "variance_shift": 1.0,
          "ks_statistic": 0.020823692734844978
        }
      },
      {
        "feature": "log_so2",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.07627543797328018,
          "variance_shift": 0.6306186732531986,
          "ks_statistic": 0.45084595396060884
        }
      },
      {
        "feature": "log_windspeed_kph",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.06973098454803969,
          "variance_shift": 0.8535360408195558,
          "ks_statistic": 0.3438661150190713
        }
      },
      {
        "feature": "log_no2",
        "drift_type": "variance_shift",
        "metrics": {
          "mean_shift": 0.06490027933381405,
          "variance_shift": 0.30590947875848135,
          "ks_statistic": 0.14696242425570016
        }
      },
      {
        "feature": "scaled_temp_C",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0284607769582648,
          "variance_shift": 0.3888884919171531,
          "ks_statistic": 0.21088746443817102
        }
      },
      {
        "feature": "scaled_humidity_%",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9701990535274616,
          "variance_shift": 0.28272085179331385,
          "ks_statistic": 0.13392605330098656
        }
      },
      {
        "feature": "scaled_log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.1216610240611602,
          "variance_shift": 0.1317957695554711,
          "ks_statistic": 0.1272367329392211
        }
      },
      {
        "feature": "scaled_log_pm2_5",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9656943879721341,
          "variance_shift": 0.22460998018028136,
          "ks_statistic": 0.12314592466231665
        }
      },
      {
        "feature": "scaled_log_pm10",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.021019818526203,
          "variance_shift": 0.19655375122996788,
          "ks_statistic": 0.15139002598512086
        }
      },
      {
        "feature": "scaled_log_precip_mm",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0,
          "variance_shift": 1.0,
          "ks_statistic": 0.6126793151318833
        }
      },
      {
        "feature": "scaled_log_co",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0122731588917078,
          "variance_shift": 0.24670856597361407,
          "ks_statistic": 0.19367540230388627
        }
      },
      {
        "feature": "scaled_log_no2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0526807212760034,
          "variance_shift": 0.06477315006887005,
          "ks_statistic": 0.08460087237718676
        }
      },
      {
        "feature": "scaled_log_so2",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9888571185872742,
          "variance_shift": 0.0720275825625236,
          "ks_statistic": 0.16621441421213606
        }
      },
      {
        "feature": "scaled_o3",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9451877401337971,
          "variance_shift": 0.17257773557861897,
          "ks_statistic": 0.10643768362773097
        }
      },
      {
        "feature": "aqi_us_lag1",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.17736701933060017,
          "variance_shift": 0.9381984331206826,
          "ks_statistic": 0.7427117075428042
        }
      },
      {
        "feature": "aqi_us_lag12",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.17791124908605244,
          "variance_shift": 0.9394023091746707,
          "ks_statistic": 0.7459509486348913
        }
      },
      {
        "feature": "aqi_us_lag24",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.18148060689398063,
          "variance_shift": 0.935219036959174,
          "ks_statistic": 0.7515039333641832
        }
      },
      {
        "feature": "scaled_log_pm2_5_lag1",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.040678337269566,
          "variance_shift": 0.19037606726378395,
          "ks_statistic": 0.12314592466231665
        }
      },
      {
        "feature": "scaled_log_pm2_5_lag12",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.8402611274527164,
          "variance_shift": 0.15236630211905722,
          "ks_statistic": 0.12512013668885488
        }
      },
      {
        "feature": "scaled_log_pm2_5_lag24",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0051487711168328,
          "variance_shift": 0.2255497311046069,
          "ks_statistic": 0.15051655353509907
        }
      },
      {
        "feature": "scaled_log_pm10_lag1",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.1259709016800263,
          "variance_shift": 0.15687187107781983,
          "ks_statistic": 0.15139002598512086
        }
      },
      {
        "feature": "scaled_log_pm10_lag12",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.9688208421410373,
          "variance_shift": 0.14237637016859775,
          "ks_statistic": 0.1286468843867484
        }
      },
      {
        "feature": "scaled_log_pm10_lag24",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0331537737600545,
          "variance_shift": 0.20364335645641907,
          "ks_statistic": 0.15217040105802432
        }
      },
      {
        "feature": "hour_sin",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 11.786982253586324,
          "variance_shift": 0.0007307073636583821,
          "ks_statistic": 0.07745701776243193
        }
      },
      {
        "feature": "hour_cos",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 11.786982252347485,
          "variance_shift": 0.010169288516791167,
          "ks_statistic": 0.07927515477438946
        }
      },
      {
        "feature": "log_pm2_5_scaled_log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.0395518481503758,
          "variance_shift": 0.060992733315560606,
          "ks_statistic": 0.12363331681311249
        }
      },
      {
        "feature": "scaled_temp_C_scaled_o3",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 1.6017354349369166,
          "variance_shift": 0.06791272224373784,
          "ks_statistic": 0.3260543962498186
        }
      },
      {
        "feature": "scaled_temp_C_scaled_log_windspeed_kph",
        "drift_type": "mean_shift",
        "metrics": {
          "mean_shift": 0.7409162861737226,
          "variance_shift": 0.07222735717129397,
          "ks_statistic": 0.2340194244939199
        }
      }
    ],
    "llm_prompt": "Drift Monitoring Agent - LLM Prompt Template\nSystem Prompt\nYou are a Data Quality and Drift Monitoring Agent for an Air Quality Index (AQI) prediction pipeline in Karachi, Pakistan. You are an expert in environmental data analysis, time series patterns, and feature engineering for air quality prediction.\nTask Description\nAnalyze the provided drift detection results to identify seasonal pattern shifts and recommend new features that could improve AQI prediction accuracy.\nYour Responsibilities:\n\t1\tDrift Analysis: Review statistical drift metrics for all features\n\t2\tPattern Recognition: Identify seasonal shifts, distribution changes, and anomalous patterns\n\t3\tFeature Recommendation: Suggest new data sources and engineered features\n\t4\tContextual Reasoning: Consider Karachi's environmental factors (monsoon seasons, urban pollution, industrial activity)\nFeature Categories to Analyze:\nRaw Domain Features:\n\t\u2022\tMeteorological: temp_C, humidity_%, windspeed_kph, precip_mm\n\t\u2022\tPollutants: pm10, pm2_5, co, no2, so2, o3\nEngineered Features:\n\t\u2022\tLogged transformations: log_* features\n\t\u2022\tScaled features: scaled_* features\n\t\u2022\tTemporal lags: *_lag1, *_lag12, *_lag24\n\t\u2022\tTime encodings: hour_sin, hour_cos, day_of_week, is_weekend\n\t\u2022\tInteractions: log_pm2_5_scaled_log_windspeed_kph, etc.\nRecommended Feature Types:\nExternal Data Sources:\n\t\u2022\tuv_index: UV radiation affects photochemical smog formation\n\t\u2022\tair_pressure_hpa: Atmospheric pressure influences pollutant dispersion\n\t\u2022\tvisibility_km: Directly correlated with particulate matter concentration\n\t\u2022\tdew_point_C: Affects particulate growth and deposition\n\t\u2022\twind_direction: Critical for pollution transport patterns\n\t\u2022\tpollen_index: Seasonal allergen levels\n\t\u2022\tdust_storm_indicator: Common in Karachi's arid climate\nTemporal Features:\n\t\u2022\tmonth_sin, month_cos: Seasonal encoding\n\t\u2022\tmonsoon_season: Boolean for Jun-Sep monsoon period\n\t\u2022\twinter_pollution_season: Oct-Feb high pollution period\n\t\u2022\tRolling averages: *_rolling_3d, *_rolling_7d, *_rolling_14d\nInteraction Terms:\n\t\u2022\ttemp_humidity_interaction: Heat index proxy\n\t\u2022\twind_pm_interaction: Pollutant dispersion effectiveness\n\t\u2022\tpressure_temp_interaction: Atmospheric stability\nInput Format\nData Summary:\n\n    Data Period: 2025-04-01 00:00:00 to 2025-08-12 23:00:00\n    Recent Period (7 days): 2025-08-05 23:00:00 to 2025-08-12 23:00:00\n    Baseline Period (90 days): 2025-05-07 23:00:00 to 2025-08-05 23:00:00\n    \n{drift_detection_results}\n{top_drifting_features}\nOutput Format\nRespond with ONLY valid JSON in this exact structure:\n{\n  \"seasonal_shift_detected\": boolean,\n  \"features_to_add\": [\"feature_name_1\", \"feature_name_2\", \"...\"],\n  \"reasoning\": \"concise explanation (max 200 words)\"\n}\nOutput Guidelines:\n\t\u2022\tseasonal_shift_detected: true if significant drift detected (>15% threshold or major pattern changes)\n\t\u2022\tfeatures_to_add: 3-8 most impactful feature recommendations\n\t\u2022\treasoning: Explain detected patterns and why recommended features would help\nDecision Criteria:\nDetect seasonal_shift = true when:\n\t\u2022\tMultiple features show >15% mean/variance shifts\n\t\u2022\tDistribution changes (KS statistic >0.2) in key pollutants\n\t\u2022\tClear seasonal pattern disruptions\n\t\u2022\tCorrelation structure changes between weather and pollutants\nFeature Prioritization:\n\t1\tFeatures addressing specific drift patterns detected\n\t2\tExternal data that explains recent anomalies\n\t3\tRolling/lag features for high-variance periods\n\t4\tInteraction terms for non-linear relationships\nContext: Karachi Environmental Factors\n\t\u2022\tMonsoon Season (Jun-Sep): High humidity, rainfall, wind pattern changes\n\t\u2022\tWinter Pollution (Oct-Feb): Temperature inversions, reduced mixing height\n\t\u2022\tSummer Heat (Mar-May): High temperatures, dust storms, photochemical reactions\n\t\u2022\tUrban Factors: Traffic patterns, industrial emissions, construction activity\n\t\u2022\tCoastal Influence: Sea breeze effects, salt particles, humidity variations\nRemember: Focus on actionable recommendations that can be implemented through available APIs or data sources.\n"
  }
}